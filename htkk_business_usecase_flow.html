<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HTKK AI Tax - System Architecture & Component Overview</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        .container {
            max-width: 1600px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
        }
        
        .title {
            text-align: center;
            color: #2c3e50;
            margin-bottom: 30px;
            font-size: 2.5em;
            font-weight: bold;
        }
        
        .architecture-header {
            background: linear-gradient(135deg, #74b9ff, #0984e3);
            color: white;
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 30px;
            text-align: center;
        }
        
        .arch-title {
            font-size: 1.8em;
            margin-bottom: 10px;
        }
        
        .arch-desc {
            font-size: 1.1em;
            opacity: 0.9;
        }
        
        .system-architecture {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 25px;
            margin: 30px 0;
            border: 2px solid #3498db;
        }
        
        .arch-section-title {
            font-size: 1.5em;
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 20px;
            text-align: center;
        }
        
        .component-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        
        .component-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            border: 2px solid;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        
        .comp-frontend { border-color: #e74c3c; }
        .comp-backend { border-color: #3498db; }
        .comp-ai { border-color: #9b59b6; }
        .comp-storage { border-color: #f39c12; }
        .comp-database { border-color: #27ae60; }
        
        .component-title {
            font-size: 1.2em;
            font-weight: bold;
            margin-bottom: 15px;
            color: #2c3e50;
            display: flex;
            align-items: center;
        }
        
        .component-title::before {
            content: "🔧 ";
            margin-right: 8px;
        }
        
        .component-desc {
            color: #34495e;
            line-height: 1.6;
            margin-bottom: 15px;
        }
        
        .component-features {
            list-style: none;
            padding: 0;
            margin: 0;
        }
        
        .component-features li {
            padding: 5px 0;
            border-bottom: 1px solid #ecf0f1;
            color: #2c3e50;
            font-size: 0.9em;
        }
        
        .component-features li:before {
            content: "✅ ";
            color: #27ae60;
            font-weight: bold;
        }
        
        .component-tech {
            background: #ecf0f1;
            border-radius: 8px;
            padding: 10px;
            margin-top: 15px;
            font-size: 0.85em;
            color: #7f8c8d;
        }
        
        .privacy-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .privacy-tier {
            border: 3px solid;
            border-radius: 15px;
            padding: 20px;
            background: white;
        }
        
        .privacy-basic { border-color: #3498db; }
        .privacy-premium { border-color: #e74c3c; }
        .privacy-enterprise { border-color: #27ae60; }
        
        .tier-header {
            text-align: center;
            padding: 10px;
            border-radius: 10px;
            color: white;
            margin-bottom: 15px;
            font-weight: bold;
            font-size: 1.2em;
        }
        
        .privacy-basic .tier-header { background: #3498db; }
        .privacy-premium .tier-header { background: #e74c3c; }
        .privacy-enterprise .tier-header { background: #27ae60; }
        
        .tier-features {
            list-style: none;
            padding: 0;
            margin: 0;
        }
        
        .tier-features li {
            padding: 8px 0;
            border-bottom: 1px solid #ecf0f1;
            color: #2c3e50;
        }
        
        .tier-features li:before {
            content: "✅ ";
            color: #27ae60;
            font-weight: bold;
        }
        
        .tier-cost {
            text-align: center;
            font-size: 1.3em;
            font-weight: bold;
            color: #e74c3c;
            margin-top: 15px;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 8px;
        }
        
        .flow-timeline {
            position: relative;
            margin: 40px 0;
        }
        
        .timeline-line {
            position: absolute;
            left: 50%;
            top: 0;
            bottom: 0;
            width: 4px;
            background: linear-gradient(to bottom, #3498db, #e74c3c);
            transform: translateX(-50%);
            z-index: 1;
        }
        
        .flow-step {
            display: flex;
            margin-bottom: 40px;
            align-items: center;
            position: relative;
            z-index: 2;
        }
        
        .flow-step:nth-child(even) {
            flex-direction: row-reverse;
        }
        
        .step-content {
            flex: 1;
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 8px 20px rgba(0,0,0,0.1);
            margin: 0 30px;
            border: 3px solid;
            position: relative;
        }
        
        .step-content::before {
            content: '';
            position: absolute;
            top: 50%;
            width: 20px;
            height: 20px;
            background: inherit;
            border: inherit;
            transform: translateY(-50%) rotate(45deg);
        }
        
        .step-ai { border-color: #9b59b6; }
        .step-client { border-color: #e74c3c; }
        .step-cloudflare { border-color: #f39c12; }
        .step-hybrid { border-color: #3498db; }
        
        .flow-step:nth-child(odd) .step-content::before {
            right: -13px;
        }
        
        .flow-step:nth-child(even) .step-content::before {
            left: -13px;
        }
        
        .step-number {
            position: absolute;
            left: 50%;
            transform: translateX(-50%);
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 1.2em;
            box-shadow: 0 4px 10px rgba(0,0,0,0.3);
            z-index: 3;
        }
        
        .step-title {
            font-size: 1.4em;
            font-weight: bold;
            margin-bottom: 10px;
            color: #2c3e50;
        }
        
        .step-location {
            background: #ecf0f1;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.9em;
            color: #7f8c8d;
            display: inline-block;
            margin-bottom: 15px;
        }
        
        .step-location.ai { background: #f4e6ff; color: #9b59b6; }
        .step-location.client { background: #ffeaa7; color: #e17055; }
        .step-location.cloudflare { background: #fff3cd; color: #e67e22; }
        .step-location.hybrid { background: #cce5ff; color: #2980b9; }
        
        .step-description {
            color: #34495e;
            line-height: 1.6;
            margin-bottom: 15px;
        }
        
        .step-data {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 15px;
            border-left: 4px solid #27ae60;
            margin-bottom: 15px;
        }
        
        .step-data-title {
            font-weight: bold;
            color: #27ae60;
            margin-bottom: 8px;
        }
        
        .step-data ul {
            margin: 0;
            padding-left: 20px;
        }
        
        .step-data li {
            margin-bottom: 5px;
            color: #2c3e50;
        }
        
        .ai-agents-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        
        .agent-card {
            background: linear-gradient(135deg, #74b9ff, #0984e3);
            color: white;
            border-radius: 10px;
            padding: 15px;
            font-size: 0.9em;
        }
        
        .agent-title {
            font-weight: bold;
            margin-bottom: 8px;
        }
        
        .agent-desc {
            opacity: 0.9;
            margin-bottom: 10px;
        }
        
        .agent-tasks {
            list-style: none;
            padding: 0;
            margin: 0;
        }
        
        .agent-tasks li {
            padding: 2px 0;
            font-size: 0.85em;
        }
        
        .agent-tasks li:before {
            content: "⚡ ";
            margin-right: 5px;
        }
        
        .enhanced-features {
            background: linear-gradient(135deg, #a29bfe, #6c5ce7);
            color: white;
            border-radius: 15px;
            padding: 25px;
            margin: 30px 0;
        }
        
        .enhanced-title {
            font-size: 1.5em;
            font-weight: bold;
            margin-bottom: 20px;
            text-align: center;
        }
        
        .enhanced-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }
        
        .enhanced-item {
            background: rgba(255,255,255,0.1);
            border-radius: 10px;
            padding: 20px;
            border: 1px solid rgba(255,255,255,0.2);
        }
        
        .enhanced-item-title {
            font-weight: bold;
            margin-bottom: 10px;
            font-size: 1.1em;
        }
        
        .enhanced-item-desc {
            opacity: 0.9;
            line-height: 1.5;
        }
        
        .recommendation-box {
            background: linear-gradient(135deg, #fdcb6e, #e17055);
            color: white;
            border-radius: 15px;
            padding: 25px;
            margin: 30px 0;
            text-align: center;
        }
        
        .rec-title {
            font-size: 1.5em;
            font-weight: bold;
            margin-bottom: 15px;
        }
        
        .rec-desc {
            font-size: 1.1em;
            opacity: 0.95;
            line-height: 1.6;
        }
        
        .cost-comparison {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 25px;
            margin-top: 30px;
        }
        
        .comparison-title {
            font-size: 1.5em;
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 20px;
            text-align: center;
        }
        
        .comparison-table {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr 1fr;
            gap: 15px;
        }
        
        .comparison-item {
            background: white;
            border-radius: 10px;
            padding: 15px;
            text-align: center;
            border: 2px solid;
        }
        
        .comp-basic { border-color: #3498db; }
        .comp-premium { border-color: #e74c3c; }
        .comp-enterprise { border-color: #27ae60; }
        .comp-traditional { border-color: #7f8c8d; }
        
        .comp-item-title {
            font-weight: bold;
            margin-bottom: 10px;
            color: #2c3e50;
        }
        
        .comp-item-cost {
            font-size: 1.3em;
            font-weight: bold;
            margin-bottom: 10px;
        }
        
        .comp-item-features {
            font-size: 0.85em;
            color: #7f8c8d;
        }
        
        @media (max-width: 768px) {
            .flow-step {
                flex-direction: column !important;
            }
            
            .step-content {
                margin: 20px 0;
            }
            
            .step-content::before {
                display: none;
            }
            
            .timeline-line {
                left: 30px;
            }
            
            .step-number {
                left: 30px;
            }
            
            .privacy-options {
                grid-template-columns: 1fr;
            }
            
            .comparison-table {
                grid-template-columns: 1fr 1fr;
            }
            
            .component-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1 class="title">🏗️ HTKK AI Tax - System Architecture & Component Overview</h1>
        
        <div class="architecture-header">
            <div class="arch-title">⚖️ Complete System Architecture</div>
            <div class="arch-desc">
                Comprehensive overview of all system components, their roles, and how they work together
            </div>
        </div>
        
        <!-- System Architecture Overview -->
        <div class="system-architecture">
            <div class="arch-section-title">🏗️ System Architecture Components</div>
            
            <div class="component-grid">
                <!-- Frontend Components -->
                <div class="component-card comp-frontend">
                    <div class="component-title">Frontend Layer (React + TypeScript)</div>
                    <div class="component-desc">
                        User interface components built with React and TypeScript, providing a modern and responsive experience.
                    </div>
                    <ul class="component-features">
                        <li>Chat interface for AI interactions</li>
                        <li>Document upload and management</li>
                        <li>Form rendering and validation</li>
                        <li>Real-time chat with AI agents</li>
                        <li>File download and export functionality</li>
                        <li>Responsive design for all devices</li>
                    </ul>
                    <div class="component-tech">
                        <strong>Technologies:</strong> React 18, TypeScript, Tailwind CSS, Vite
                    </div>
                </div>
                
                <!-- Backend Components -->
                <div class="component-card comp-backend">
                    <div class="component-title">Backend API (FastAPI + Python)</div>
                    <div class="component-desc">
                        RESTful API server handling business logic, AI agent orchestration, and data processing.
                    </div>
                    <ul class="component-features">
                        <li>AI agent management and routing</li>
                        <li>Document processing endpoints</li>
                        <li>User session management</li>
                        <li>Data validation and sanitization</li>
                        <li>Error handling and logging</li>
                        <li>API rate limiting and security</li>
                    </ul>
                    <div class="component-tech">
                        <strong>Technologies:</strong> FastAPI, Python 3.11+, Pydantic, Uvicorn
                    </div>
                </div>
                
                <!-- AI Components -->
                <div class="component-card comp-ai">
                    <div class="component-title">AI Agent System (Google ADK)</div>
                    <div class="component-desc">
                        Intelligent agents powered by Google's ADK framework, handling OCR, form mapping, and tax calculations.
                    </div>
                    <ul class="component-features">
                        <li>OCR Agent: Document processing and text extraction</li>
                        <li>Form Agent: Tax form mapping and validation</li>
                        <li>Root Agent: Request routing and coordination</li>
                        <li>LLM integration with Gemini models</li>
                        <li>Tool-based processing pipeline</li>
                        <li>Intelligent document chunking</li>
                    </ul>
                    <div class="component-tech">
                        <strong>Technologies:</strong> Google ADK, Gemini 2.5 Flash Lite, Custom Tools
                    </div>
                </div>
                
                <!-- Storage Components -->
                <div class="component-card comp-storage">
                    <div class="component-title">Cloud Storage (Cloudflare R2)</div>
                    <div class="component-desc">
                        Scalable object storage for documents, with privacy controls and automatic cleanup.
                    </div>
                    <ul class="component-features">
                        <li>Document upload and storage</li>
                        <li>Privacy tier-based retention</li>
                        <li>Automatic file cleanup</li>
                        <li>CDN integration for fast access</li>
                        <li>Encryption at rest and in transit</li>
                        <li>Cost-effective storage solution</li>
                    </ul>
                    <div class="component-tech">
                        <strong>Technologies:</strong> Cloudflare R2, S3-compatible API, CORS support
                    </div>
                </div>
                
                <!-- Database Components -->
                <div class="component-card comp-database">
                    <div class="component-title">Database Layer (Cloudflare D1)</div>
                    <div class="component-desc">
                        Serverless SQL database for user sessions, metadata, and system state management.
                    </div>
                    <ul class="component-features">
                        <li>User session tracking</li>
                        <li>Document metadata storage</li>
                        <li>Processing history and logs</li>
                        <li>Form template management</li>
                        <li>Audit trail maintenance</li>
                        <li>Real-time data synchronization</li>
                    </ul>
                    <div class="component-tech">
                        <strong>Technologies:</strong> Cloudflare D1, SQLite, Serverless SQL
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Enhanced AI Features -->
        <div class="enhanced-features">
            <div class="enhanced-title">🚀 Enhanced AI Integration Features</div>
            <div class="enhanced-grid">
                <div class="enhanced-item">
                    <div class="enhanced-item-title">📄 Intelligent Document Processing</div>
                    <div class="enhanced-item-desc">
                        Advanced OCR with PDF page chunking, automatic form detection, and intelligent data mapping using LLMs.
                    </div>
                </div>
                
                <div class="enhanced-item">
                    <div class="enhanced-item-title">🧠 LLM-Optimized Tools</div>
                    <div class="enhanced-item-desc">
                        Custom tools designed specifically for LLM processing, including document analysis, structure detection, and form mapping.
                    </div>
                </div>
                
                <div class="enhanced-item">
                    <div class="enhanced-item-title">🔄 End-to-End Pipeline</div>
                    <div class="enhanced-item-desc">
                        Complete workflow from document upload to XML export: R2 → OCR → Mapping → XML generation → Download.
                    </div>
                </div>
                
                <div class="enhanced-item">
                    <div class="enhanced-item-title">📊 Smart Form Detection</div>
                    <div class="enhanced-item-desc">
                        Automatic detection of tax form types (01/GTGT, 02/TNCN, 03/TNDN) based on document content analysis.
                    </div>
                </div>
            </div>
        </div>
        
        <div class="privacy-options">
            <div class="privacy-tier privacy-basic">
                <div class="tier-header">💼 BASIC TIER</div>
                <ul class="tier-features">
                    <li>Cloud-based OCR & mapping</li>
                    <li>Temporary data processing</li>
                    <li>Auto-delete sau 24h</li>
                    <li>Standard encryption</li>
                    <li>Form guidance & validation</li>
                    <li>Basic AI assistance</li>
                </ul>
                <div class="tier-cost">~$0.50/form</div>
            </div>
            
            <div class="privacy-tier privacy-premium">
                <div class="tier-header">🔒 PREMIUM TIER</div>
                <ul class="tier-features">
                    <li>Enhanced privacy processing</li>
                    <li>Data anonymization layer</li>
                    <li>Auto-delete sau 1h</li>
                    <li>End-to-end encryption</li>
                    <li>Advanced AI agents</li>
                    <li>Priority processing</li>
                    <li>Audit logs</li>
                </ul>
                <div class="tier-cost">~$0.80/form</div>
            </div>
            
            <div class="privacy-tier privacy-enterprise">
                <div class="tier-header">🏢 ENTERPRISE TIER</div>
                <ul class="tier-features">
                    <li>On-premises AI processing</li>
                    <li>Zero cloud data storage</li>
                    <li>Private AI model deployment</li>
                    <li>Custom compliance rules</li>
                    <li>Dedicated infrastructure</li>
                    <li>Full audit trail</li>
                    <li>SLA guarantees</li>
                </ul>
                <div class="tier-cost">Custom pricing</div>
            </div>
        </div>
        
        <div class="flow-timeline">
            <div class="timeline-line"></div>
            
            <!-- Step 0: AI Consultation -->
            <div class="flow-step">
                <div class="step-number">0</div>
                <div class="step-content step-ai">
                    <div class="step-location ai">🤖 AI CONSULTATION</div>
                    <div class="step-title">💬 AI Interview & Form Recommendation</div>
                    <div class="step-description">
                        AI agent conduct business assessment để understand user's tax situation 
                        và recommend appropriate forms với priority order.
                    </div>
                    <div class="step-data">
                        <div class="step-data-title">🧠 AI Consultation Process:</div>
                        <ul>
                            <li>Business type identification (company, individual, etc.)</li>
                            <li>Revenue assessment và employee count</li>
                            <li>Tax obligations analysis</li>
                            <li>Form priority recommendations</li>
                            <li>Deadline tracking và reminders</li>
                            <li>Compliance requirement explanations</li>
                        </ul>
                    </div>
                    <div class="cost-impact">
                        <div class="cost-impact-title">💰 Cost Impact:</div>
                        <div class="cost-impact-desc">~$0.02 per consultation session</div>
                    </div>
                </div>
            </div>
            
            <!-- Step 1: Form Selection -->
            <div class="flow-step">
                <div class="step-number">1</div>
                <div class="step-content step-client">
                    <div class="step-location client">📱 CLIENT DEVICE</div>
                    <div class="step-title">🎯 Form Selection & Template Loading</div>
                    <div class="step-description">
                        User chọn form từ AI recommendations. Client download latest XML template 
                        từ Cloudflare và render dynamic form interface.
                    </div>
                    <div class="step-data">
                        <div class="step-data-title">📋 Client Form Processing:</div>
                        <ul>
                            <li>Display AI-recommended forms với explanations</li>
                            <li>Check template version và download updates nếu cần</li>
                            <li>Parse XML template (Menu.xml, MapMCT.xml logic)</li>
                            <li>Render dynamic form với validation rules</li>
                            <li>Setup field dependencies và calculation logic</li>
                            <li>Prepare form for document input</li>
                        </ul>
                    </div>
                    <div class="cost-impact">
                        <div class="cost-impact-title">💰 Cost Impact:</div>
                        <div class="cost-impact-desc">FREE - Template download (Class B + zero egress)</div>
                    </div>
                </div>
            </div>
            
            <!-- Step 2: Document Upload -->
            <div class="flow-step">
                <div class="step-number">2</div>
                <div class="step-content step-cloudflare">
                    <div class="step-location cloudflare">📱 CLIENT → ☁️ CLOUDFLARE</div>
                    <div class="step-title">📤 Document Upload with Privacy Options</div>
                    <div class="step-description">
                        User upload documents (XML invoices, PDF statements) lên Cloudflare R2. 
                        Privacy level được apply based on user's subscription tier.
                    </div>
                    <div class="step-data">
                        <div class="step-data-title">📊 Upload Processing:</div>
                        <ul>
                            <li>Client validate file types và sizes</li>
                            <li>Apply encryption dựa trên privacy tier</li>
                            <li>Upload to secure R2 bucket với unique IDs</li>
                            <li>Generate temporary processing URLs</li>
                            <li>Create processing queue với auto-expire settings</li>
                            <li>Log upload metadata to D1 (file refs only)</li>
                        </ul>
                    </div>
                    
                    <div class="privacy-levels">
                        <div class="privacy-levels-title">🔒 Privacy Level Processing:</div>
                        <div class="privacy-level level-basic"><strong>Basic:</strong> Standard encryption, 24h auto-delete</div>
                        <div class="privacy-level level-premium"><strong>Premium:</strong> Advanced encryption, 1h auto-delete</div>
                        <div class="privacy-level level-enterprise"><strong>Enterprise:</strong> Private bucket, immediate delete after processing</div>
                    </div>
                    
                    <div class="cost-impact">
                        <div class="cost-impact-title">💰 Cost Impact:</div>
                        <div class="cost-impact-desc">Class A operations (PUT) ~$0.01-0.05 per document set</div>
                    </div>
                </div>
            </div>
            
            <!-- Step 3: AI OCR Processing -->
            <div class="flow-step">
                <div class="step-number">3</div>
                <div class="step-content step-ai">
                    <div class="step-location ai">🤖 GOOGLE ADK AI</div>
                    <div class="step-title">🔍 Enhanced OCR & Data Extraction</div>
                    <div class="step-description">
                        Google ADK AI agents perform sophisticated OCR với intelligent PDF chunking 
                        và extract structured data từ documents với high accuracy.
                    </div>
                    
                    <div class="ai-agents-grid">
                        <div class="agent-card">
                            <div class="agent-title">📄 Enhanced OCR Agent</div>
                            <div class="agent-desc">Advanced OCR với intelligent page chunking</div>
                            <ul class="agent-tasks">
                                <li>PDF page analysis và chunking (>3 pages)</li>
                                <li>Intelligent form type detection</li>
                                <li>Multi-language OCR (VN/EN)</li>
                                <li>Table structure recognition</li>
                                <li>Image quality enhancement</li>
                                <li>Tax form format recognition</li>
                            </ul>
                        </div>
                        
                        <div class="agent-card">
                            <div class="agent-title">🔍 Data Parser Agent</div>
                            <div class="agent-desc">Intelligent data extraction từ documents</div>
                            <ul class="agent-tasks">
                                <li>XML invoice parsing</li>
                                <li>PDF bank statement analysis</li>
                                <li>Entity recognition (companies, amounts)</li>
                                <li>Date format standardization</li>
                                <li>Currency amount extraction</li>
                                <li>Pattern-based form detection</li>
                            </ul>
                        </div>
                        
                        <div class="agent-card">
                            <div class="agent-title">✅ Validation Agent</div>
                            <div class="agent-desc">Data accuracy và consistency validation</div>
                            <ul class="agent-tasks">
                                <li>Cross-document validation</li>
                                <li>Amount calculation verification</li>
                                <li>Date range consistency</li>
                                <li>Format compliance checking</li>
                                <li>Error detection & flagging</li>
                                <li>Mapping quality assessment</li>
                            </ul>
                        </div>
                        
                        <div class="agent-card">
                            <div class="agent-title">🎯 Context Agent</div>
                            <div class="agent-desc">Business context understanding</div>
                            <ul class="agent-tasks">
                                <li>Transaction type identification</li>
                                <li>Business rule application</li>
                                <li>Tax category classification</li>
                                <li>Period-based grouping</li>
                                <li>Regulatory compliance check</li>
                                <li>Form type recommendation</li>
                            </ul>
                        </div>
                    </div>
                    
                    <div class="data-security">
                        <div class="security-title">🔒 Data Security Measures:</div>
                        <ul class="security-measures">
                            <li>Processing trong isolated containers</li>
                            <li>Memory cleared sau mỗi processing session</li>
                            <li>No persistent storage of sensitive data</li>
                            <li>Encrypted data transmission</li>
                            <li>Audit logging for compliance</li>
                            <li>Auto-delete processing artifacts</li>
                        </ul>
                    </div>
                    
                    <div class="cost-impact">
                        <div class="cost-impact-title">💰 Cost Impact:</div>
                        <div class="cost-impact-desc">~$0.25-0.50 per document set (depends on complexity)</div>
                    </div>
                </div>
            </div>
            
            <!-- Step 4: Intelligent Mapping -->
            <div class="flow-step">
                <div class="step-number">4</div>
                <div class="step-content step-ai">
                    <div class="step-location ai">🤖 AI MAPPING ENGINE</div>
                    <div class="step-title">🧠 Intelligent Field Mapping & User Commands</div>
                    <div class="step-description">
                        AI agents analyze extracted data và user instructions để create precise 
                        field mappings cho target tax form với explanations.
                    </div>
                    <div class="step-data">
                        <div class="step-data-title">🎯 Enhanced Mapping Intelligence:</div>
                        <ul>
                            <li><strong>Form Understanding:</strong> Deep knowledge của HTKK form structures</li>
                            <li><strong>Business Logic:</strong> Apply tax rules và calculations</li>
                            <li><strong>User Intent:</strong> Process natural language commands</li>
                            <li><strong>Data Transformation:</strong> Convert formats và units</li>
                            <li><strong>Confidence Scoring:</strong> Rate mapping accuracy</li>
                            <li><strong>Exception Handling:</strong> Flag unusual cases</li>
                            <li><strong>Auto Form Detection:</strong> Identify form types from content</li>
                            <li><strong>Smart Field Mapping:</strong> Intelligent field correlation</li>
                        </ul>
                    </div>
                    
                    <div style="background: #f4e6ff; border-radius: 10px; padding: 15px; margin: 15px 0; border-left: 4px solid #9b59b6;">
                        <div style="font-weight: bold; color: #9b59b6; margin-bottom: 8px;">💬 User Command Examples:</div>
                        <ul style="margin: 0; padding-left: 20px; color: #2c3e50;">
                            <li>"Map tất cả invoices vào tờ khai 01/GTGT cho Q1 2024"</li>
                            <li>"Tính tổng VAT từ bank statements này"</li>
                            <li>"Kiểm tra consistency giữa hóa đơn và sao kê"</li>
                            <li>"Adjust amounts cho period từ Jan-Mar only"</li>
                            <li>"Group by tax rates và export summary"</li>
                        </ul>
                    </div>
                    
                    <div class="cost-impact">
                        <div class="cost-impact-title">💰 Cost Impact:</div>
                        <div class="cost-impact-desc">~$0.15-0.25 per mapping session</div>
                    </div>
                </div>
            </div>
            
            <!-- Step 5: Secure Data Return -->
            <div class="flow-step">
                <div class="step-number">5</div>
                <div class="step-content step-hybrid">
                    <div class="step-location hybrid">🤖 AI → 📱 CLIENT</div>
                    <div class="step-title">📋 Secure Mapping Response & Cleanup</div>
                    <div class="step-description">
                        AI return structured field mappings với explanations. 
                        All source documents được auto-deleted theo privacy tier settings.
                    </div>
                    <div class="step-data">
                        <div class="step-data-title">📤 Enhanced Response Data:</div>
                        <ul>
                            <li><strong>Field Mappings:</strong> Exact values cho form fields</li>
                            <li><strong>Explanations:</strong> How values được calculated</li>
                            <li><strong>Confidence Scores:</strong> AI certainty levels</li>
                            <li><strong>Validation Results:</strong> Errors và warnings</li>
                            <li><strong>Suggestions:</strong> Optimization recommendations</li>
                            <li><strong>Summary Stats:</strong> Totals và breakdowns</li>
                            <li><strong>Form Type Detection:</strong> Recommended form types</li>
                            <strong>Processing Metadata:</strong> Chunking info và strategies</li>
                        </ul>
                    </div>
                    
                    <div style="background: #e8f5e8; border-radius: 10px; padding: 15px; margin: 15px 0; border-left: 4px solid #27ae60;">
                        <div style="font-weight: bold; color: #27ae60; margin-bottom: 8px;">🗑️ Auto-Cleanup Process:</div>
                        <ul style="margin: 0; padding-left: 20px; color: #2c3e50;">
                            <li><strong>Basic Tier:</strong> Documents deleted sau 24h</li>
                            <li><strong>Premium Tier:</strong> Documents deleted sau 1h</li>
                            <li><strong>Enterprise Tier:</strong> Immediate deletion sau processing</li>
                            <li><strong>AI Memory:</strong> Processing context cleared instantly</li>
                            <li><strong>Audit Logs:</strong> Only metadata retained (no content)</li>
                            <li><strong>Processing Artifacts:</strong> Temporary files auto-removed</li>
                        </ul>
                    </div>
                    
                    <div class="cost-impact">
                        <div class="cost-impact-title">💰 Cost Impact:</div>
                        <div class="cost-impact-desc">Data transfer + cleanup operations</div>
                    </div>
                </div>
            </div>
            
            <!-- Step 6: Auto-fill & Review -->
            <div class="flow-step">
                <div class="step-number">6</div>
                <div class="step-content step-client">
                    <div class="step-location client">📱 CLIENT AUTO-FILL</div>
                    <div class="step-title">🎉 Auto-fill với Human Review</div>
                    <div class="step-description">
                        Client apply AI mappings to form fields với clear indicators 
                        của confidence levels. User review và approve trước khi finalize.
                    </div>
                    <div class="step-data">
                        <div class="step-data-title">✨ Enhanced Auto-fill Features:</div>
                        <ul>
                            <li>Visual indicators cho AI-filled vs manual fields</li>
                            <li>Confidence scores displayed as color coding</li>
                            <li>Hover explanations cho each auto-filled value</li>
                            <li>Side-by-side comparison với original documents</li>
                            <li>Easy correction tools cho manual adjustments</li>
                            <li>Real-time validation và error checking</li>
                            <li>Auto-save drafts to Cloudflare D1</li>
                            <li>Form type validation và suggestions</li>
                            <li>Mapping quality indicators</li>
                        </ul>
                    </div>
                    <div class="cost-impact">
                        <div class="cost-impact-title">💰 Cost Impact:</div>
                        <div class="cost-impact-desc">D1 operations for draft saving (~$0.01)</div>
                    </div>
                </div>
            </div>
            
            <!-- Step 7: Export & Compliance -->
            <div class="flow-step">
                <div class="step-number">7</div>
                <div class="step-content step-client">
                    <div class="step-location client">📱 CLIENT EXPORT</div>
                    <div class="step-title">📄 Generate HTKK XML Export</div>
                    <div class="step-description">
                        Client generate HTKK-compatible XML với proper formatting, 
                        digital signatures, và compliance validation.
                    </div>
                    <div class="step-data">
                        <div class="step-data-title">📋 Enhanced Export Processing:</div>
                        <ul>
                            <li>Apply final validation rules và business logic</li>
                            <li>Generate HTKK XML format với proper structure</li>
                            <li>Add digital signatures nếu required</li>
                            <li>Compliance checking với latest regulations</li>
                            <li>Export to local file system</li>
                            <li>Optional backup to Cloudflare R2</li>
                            <li>Update submission history</li>
                            <li>Form type validation và verification</li>
                            <li>Mapping quality final assessment</li>
                        </ul>
                    </div>
                    <div class="cost-impact">
                        <div class="cost-impact-title">💰 Cost Impact:</div>
                        <div class="cost-impact-desc">Optional R2 backup (~$0.01 if enabled)</div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="recommendation-box">
            <div class="rec-title">🎯 Recommended Approach</div>
            <div class="rec-desc">
                Start với <strong>Premium Tier</strong> cho optimal balance của AI power, privacy, và cost. 
                Offer Basic Tier cho price-sensitive users và Enterprise Tier cho large organizations 
                với strict compliance requirements. Progressive privacy pricing model allows users 
                to choose their comfort level.
            </div>
        </div>
        
        <div class="cost-comparison">
            <div class="comparison-title">💰 Cost Comparison Analysis</div>
            <div class="comparison-table">
                <div class="comparison-item comp-basic">
                    <div class="comp-item-title">BASIC TIER</div>
                    <div class="comp-item-cost" style="color: #3498db;">~$0.50/form</div>
                    <div class="comp-item-features">
                        Standard OCR<br>
                        24h retention<br>
                        Basic encryption<br>
                        Good for startups
                    </div>
                </div>
                
                <div class="comparison-item comp-premium">
                    <div class="comp-item-title">PREMIUM TIER</div>
                    <div class="comp-item-cost" style="color: #e74c3c;">~$0.80/form</div>
                    <div class="comp-item-features">
                        Advanced AI<br>
                        1h retention<br>
                        Enhanced privacy<br>
                        Best balance
                    </div>
                </div>
                
                <div class="comparison-item comp-enterprise">
                    <div class="comp-item-title">ENTERPRISE</div>
                    <div class="comp-item-cost" style="color: #27ae60;">Custom</div>
                    <div class="comp-item-features">
                        On-premises<br>
                        Zero retention<br>
                        Full compliance<br>
                        Large orgs
                    </div>
                </div>
                
                <div class="comparison-item comp-traditional">
                    <div class="comp-item-title">TRADITIONAL</div>
                    <div class="comp-item-cost" style="color: #7f8c8d;">$3-8/form</div>
                    <div class="comp-item-features">
                        Manual processing<br>
                        High error rates<br>
                        Slow turnaround<br>
                        Legacy approach
                    </div>
                </div>
            </div>
            
            <div style="margin-top: 25px; padding: 20px; background: white; border-radius: 10px; border: 2px solid #27ae60;">
                <h4 style="color: #27ae60; margin-top: 0;">🏆 Competitive Advantages:</h4>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; color: #2c3e50;">
                    <div>
                        <strong>🎯 Accuracy:</strong><br>
                        95%+ vs 70% manual
                    </div>
                    <div>
                        <strong>⚡ Speed:</strong><br>
                        5 minutes vs 2-4 hours
                    </div>
                    <div>
                        <strong>💰 Cost:</strong><br>
                        75% cheaper than competitors
                    </div>
                    <div>
                        <strong>🔒 Privacy:</strong><br>
                        Multiple tiers vs one-size-fits-all
                    </div>
                </div>
            </div>
        </div>
    </div>
</body>
</html>